# 项目架构总览

> **目标**: 快速理解 PaperTok 后端的核心架构和数据流

---

## 1. 项目简介

PaperTok 是一个类 TikTok 风格的论文浏览应用，主要功能：
- 论文推荐流：按分类获取最新论文
- 论文搜索：关键词搜索论文
- 论文详情：获取单篇论文详细信息

---

## 2. 技术栈

| 类别 | 技术 |
|------|------|
| 语言 | Go 1.21+ |
| Web 框架 | Gin |
| 数据源 | arXiv API |
| 缓存 | 内存缓存 |

---

## 3. 架构概览

```
┌─────────────────────────────────────────────────────────────────┐
│                         前端（浏览器）                            │
│                    React + TypeScript                           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP/REST API
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    API Layer (Handlers)                         │
│                 /api/v1/papers, /health                         │
├─────────────────────────────────────────────────────────────────┤
│                     Facade Layer                                │
│                   统一业务入口                                   │
├─────────────────────────────────────────────────────────────────┤
│    Features (垂直切片)          │     Core Services              │
│  ├─ paperfeed (论文流)          │   └─ arxiv (arXiv客户端)       │
│  └─ papersearch (搜索)          │                                │
├─────────────────────────────────────────────────────────────────┤
│                   Repository Layer                              │
│                 paper (论文数据访问)                             │
├─────────────────────────────────────────────────────────────────┤
│                 Infrastructure Layer                            │
│              cache (缓存) │ httpclient (HTTP)                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       arXiv API                                 │
│              http://export.arxiv.org/api/query                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 核心概念

### 4.1 分层说明

| 层 | 职责 | 目录 |
|---|------|------|
| **API Layer** | HTTP 请求处理、参数校验 | `internal/api/handlers/` |
| **Facade Layer** | 统一业务入口、依赖组装 | `internal/facade/` |
| **Features** | 垂直切片、业务功能 | `internal/features/` |
| **Core Services** | 共享服务、API客户端 | `internal/core/` |
| **Repository** | 数据访问抽象 | `internal/repository/` |
| **Infrastructure** | 基础设施（缓存、HTTP） | `internal/infra/` |

### 4.2 数据流

```
1. 用户请求 GET /api/v1/papers?category=cs.AI
     ↓
2. PaperHandler 解析参数
     ↓
3. Facade.GetPaperFeed()
     ↓
4. PaperFeed Feature 处理
     ↓
5. 检查 Repository 缓存
     ├─ 命中 → 返回缓存
     └─ 未命中 → 调用 arXiv Core Service
                      ↓
                 6. arXiv API 请求
                      ↓
                 7. 解析响应、写入缓存
     ↓
8. 返回 JSON 响应
```

---

## 5. 目录结构

```
backend/
├── cmd/server/main.go      # 应用入口
├── internal/
│   ├── api/                # API 层
│   │   ├── handlers/       # HTTP 处理器
│   │   └── middleware/     # 中间件
│   ├── facade/             # Facade 层
│   ├── features/           # Feature 垂直切片
│   │   ├── paperfeed/      # 论文流功能
│   │   └── papersearch/    # 搜索功能
│   ├── core/               # Core Services
│   │   └── arxiv/          # arXiv 客户端
│   ├── repository/         # Repository 层
│   │   └── paper/          # 论文数据访问
│   ├── infra/              # 基础设施
│   │   ├── cache/          # 缓存
│   │   └── httpclient/     # HTTP 客户端
│   └── config/             # 配置
├── pkg/arxiv/              # 外部可用包（兼容）
└── local-guides/           # 本地开发指南
```

---

## 6. 依赖方向

```
API Layer → Facade → Features → Core Services
                 ↘          ↘
               Repository   Infrastructure
```

**原则**：
- 依赖只能向下，禁止循环依赖
- Features 之间不能相互依赖
- Core Services 不能依赖 Features

---

## 7. 相关文档

- [02-快速开始.md](./02-快速开始.md) - 环境搭建
- [03-后端架构详解.md](./03-后端架构详解.md) - 分层详解
- [04-API接口说明.md](./04-API接口说明.md) - API 文档
